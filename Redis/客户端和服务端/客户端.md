# Redis客户端

## 客户端信息保存方式

* 在redisServer中有一个clients链表, 保存了所有与服务端连接的链表的信息

## 客户端属性

* 通用属性
  * id, socket文件描述符, flg等
* 功能属性
  * 当前使用的库, dictid, 事务的mstate, watch命令的atched_keys等

## 命令读取

* 客户端的querybuf是一个sds结构, 最大1GB
* 客户端的命令经过读取之后解析为一个字符串数组,  argc表示命令+参数个数, argv就是命令和参数的数组

## 命令实现

* 根据内置的dict根据argv[0]找到对应的redisCommand, 将客户端的cmd指针指向这个redisCommand

## 结果输出

* 输出缓冲区是一个默认大小为16KB的字符数组, 如果不够用可以使用reply链表, 发送很大的命令回复

## 时间属性

* 连接时间
* 最近活跃时间, 用于计算idle事件

## 其他

* lua_client 是伪客户端, redis启动时生成, 停止时关闭
* AOF文件载入数据库时也是用伪客户端的方式发送命令
