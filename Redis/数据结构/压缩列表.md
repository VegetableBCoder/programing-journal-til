# 压缩列表

* 当一个列表key的内容只有小的整数, 要么是短字符串, redis会使用压缩列表来存储
* 压缩列表使用一段连续内存来保存多个节点信息

## 构成

| 属性    | 长度 | 用途                                                       |
| ------- | ---- | ---------------------------------------------------------- |
| zlbytes | 4B   | 记录整个压缩列表占用的字节数                               |
| zltail  | 4B   | 记录列表尾节点距离头节点的压缩列表起始位置有多少字节       |  |
| zlen    | 2B   | 节点数量, <65536为真实值, =65536时不是真实值, 需要遍历列表 |
| entryX  | 不定 | 节点的长度和节点内容                                       |
| zlend   | 1B   | 标记列表结束                                               |

### entry构成

| 属性                  | 长度     | 用途                                                             |
| --------------------- | -------- | ---------------------------------------------------------------- |
| previous_entry_length | 1或5字节 | 前一个节点的长度, 如果第一个字节时0xFE, 说明后面四个字节才是长度 |
| encoding              | 1        | 节点内容编码方式和长度                                           |
| content               | 节点内容 |


## 连锁更新

* 当新增节点时, 后面的节点因记录前置节点的空间需要从1字节扩展到5字节, 进而循环出发后续节点空间扩展的现象
  * 触发条件苛刻: 连续多个借点都在250-253B之间才会出现